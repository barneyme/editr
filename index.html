<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>editr</title>
        <link rel="stylesheet" href="style.css" />
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'><rect width='16' height='16' fill='%23666666'/><text x='8' y='12' font-family='monospace' font-size='12' fill='white' text-anchor='middle'>e</text></svg>"
        />
    </head>
    <body>
        <textarea
            id="editor"
            placeholder="Start typing or press Ctrl\Cmd + K for menu."
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
        ></textarea>

        <div id="gridContainer" class="hidden">
            <div id="gridToolbar">
                <button id="addRowBtn">Add Row</button>
                <button id="addColBtn">Add Column</button>
                <button id="delRowBtn">Delete Row</button>
                <button id="delColBtn">Delete Column</button>
            </div>
            <div id="gridContent"></div>
        </div>

        <div id="findReplaceDialog" class="hidden">
            <input
                type="text"
                id="findInput"
                placeholder="Find (Enter/Shift+Enter)"
            />
            <div class="find-controls">
                <button id="findPrevBtn" title="Find Previous (Shift+Enter)">
                    ↑
                </button>
                <button id="findNextBtn" title="Find Next (Enter)">↓</button>
            </div>
            <input type="text" id="replaceInput" placeholder="Replace" />
            <div class="replace-controls">
                <button id="replaceBtn" title="Replace">Replace</button>
                <button id="replaceAllBtn" title="Replace All">All</button>
            </div>
            <button id="closeFindBtn" title="Close (Esc)">&times;</button>
        </div>

        <div id="commandPalette" class="hidden">
            <div class="palette-container">
                <input
                    type="text"
                    id="commandInput"
                    placeholder="Search commands or files"
                    autocomplete="off"
                />
                <div id="commandList"></div>
            </div>
        </div>

        <div id="helpModal" class="hidden modal-base">
            <button id="closeHelpBtn" class="modal-close-btn">&times;</button>
            <h3>editr Help & Shortcuts</h3>
            <pre id="helpText">
editr : browser editor
<div id="currentBuffer">Buffer: 1/1 - editr.txt</div>
<div id="wordCount">Words: 0 | Lines: 0</div>
HELP
Ctrl/Cmd + K         : Open command palette
Right-click          : Context Menu
Ctrl/Cmd + S         : Save file
Ctrl/Cmd + O         : Open file
Ctrl/Cmd + N         : New tab
Editr.cc/#NOTE       : Creates 'NOTE'
Ctrl/Cmd + F         : Find and Replace
Ctrl/Cmd + L         : Open Link from line
Ctrl/Cmd + E         : Text expansions
Ctrl/Cmd + W         : Close buffer
Ctrl/Cmd + =         : Lock/unlock note
Ctrl/Cmd + ←/→       : Switch buffers

TOOLS
Calculator   : Open a simple calculator in a new buffer.
Calendar     : Open a dynamic calendar and clock in a new buffer.
Email Buffer : Open default mail client with buffer content.
Export       : Save all buffers + expansions as JSON project.
Import       : Load project (replace or merge) from JSON project.
Text Tools   : Perform actions on text.
Text Expansion:Expand shortcut to long text.

TEXT TOOLS
Commands:
>> count words
>> count characters
>> to uppercase
>> to lowercase
>> to title case
>> to sentence case:
>> invert case
>> trim lines
>> reverse lines
>> sort lines
>> sort lines desc
>> shuffle lines
>> unique lines
>> delete blank lines
>> number lines
>> format json
>> prefix lines [text]
>> suffix lines [text]
>> extract emails
>> extract urls
>> strip html

TEXT EXPANSIONS
Type a shortcut and press Space/Enter.
.d           : Insert current date (YYYYMMDD)
.a ~ .z      : User customizable
            </pre>
        </div>

        <div id="expansionsModal" class="hidden modal-base">
            <button id="closeExpansionsBtn" class="modal-close-btn">
                &times;
            </button>
            <h3>Text Expansions</h3>
            <div id="expansionsList"></div>
            <div class="expansions-footer">
                <button
                    id="importExpansionsBtn"
                    title="Import from a .txt file"
                >
                    Import
                </button>
                <button id="exportExpansionsBtn" title="Export to a .txt file">
                    Export
                </button>
                <button id="saveExpansionsBtn" title="Save changes and close">
                    Save & Close
                </button>
            </div>
        </div>

        <div id="contextMenu">
            <div id="ctxBufferList"></div>
            <hr class="context-menu-divider" id="ctxBufferDivider" />

            <div class="context-menu-item has-submenu">
                <span>File</span>
                <div class="submenu">
                    <div class="context-menu-item" id="ctxNewTab">New Tab</div>
                    <div class="context-menu-item" id="ctxOpenFile">
                        Open File
                    </div>
                    <div class="context-menu-item" id="ctxSaveFile">
                        Save File As
                    </div>
                    <hr class="context-menu-divider" />
                    <div class="context-menu-item" id="ctxFindReplace">
                        Find / Replace
                    </div>
                </div>
            </div>

            <div class="context-menu-item has-submenu">
                <span>Buffer</span>
                <div class="submenu">
                    <div class="context-menu-item" id="ctxNextBuffer">
                        Next Buffer
                    </div>
                    <div class="context-menu-item" id="ctxPrevBuffer">
                        Previous Buffer
                    </div>
                    <div class="context-menu-item" id="ctxCloseBuffer">
                        Close Buffer
                    </div>
                    <hr class="context-menu-divider" />
                    <div class="context-menu-item" id="ctxEmailBuffer">
                        Email Buffer
                    </div>
                </div>
            </div>

            <div class="context-menu-item has-submenu">
                <span>Tools</span>
                <div class="submenu">
                    <div class="context-menu-item" id="ctxCommandPalette">
                        Command Palette
                    </div>
                    <div class="context-menu-item" id="ctxOpenLink">
                        Open Link
                    </div>
                    <div class="context-menu-item" id="ctxToggleLock">
                        Lock/Unlock Note
                    </div>
                    <div class="context-menu-item" id="ctxManageExpansions">
                        Text Expansions
                    </div>
                    <div class="context-menu-item" id="ctxCalculator">
                        Calculator
                    </div>
                    <div class="context-menu-item" id="ctxCalendar">
                        Calendar
                    </div>
                    <div class="context-menu-item" id="ctxTextTools">
                        Text Tools
                    </div>
                    <hr class="context-menu-divider" />
                    <div class="context-menu-item" id="ctxExportProject">
                        Export Project
                    </div>
                    <div class="context-menu-item" id="ctxImportProject">
                        Import Project
                    </div>
                    <hr class="context-menu-divider" />
                    <div class="context-menu-item" id="ctxToggleGridView">
                        Toggle Grid View
                    </div>
                    <div class="context-menu-item" id="ctxToggleDark">
                        Toggle Dark Mode
                    </div>
                    <div class="context-menu-item" id="ctxToggleWrap">
                        Toggle Word Wrap
                    </div>
                    <div class="context-menu-item" id="ctxToggleFullscreen">
                        Fullscreen
                    </div>
                </div>
            </div>

            <hr class="context-menu-divider" />
            <div class="context-menu-item" id="ctxShowHelp">Help</div>
        </div>

        <div id="mobileControls">
            <button class="mobile-btn" id="hamburgerBtn" title="Menu">
                ☰
            </button>
        </div>

        <input
            type="file"
            id="fileInput"
            accept=".txt,.md,.js,.html,.css,.csv,.tsv"
        />
        <input
            type="file"
            id="importExpansionsInput"
            accept=".txt"
            style="display: none"
        />
        <script src="script.js"></script>
        <script>
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker
                        .register("/sw.js")
                        .then((registration) => {
                            console.log(
                                "ServiceWorker registration successful with scope: ",
                                registration.scope,
                            );
                        })
                        .catch((error) => {
                            console.log(
                                "ServiceWorker registration failed: ",
                                error,
                            );
                        });
                });
            }
        </script>
    </body>
</html>
